<!DOCTYPE HTML>
<html>
    <head>
        <title>Contextual Navigation</title>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <link rel="stylesheet" href="css/hotspot-map.min.css" type="text/css"/>
        <link type="text/css" rel="stylesheet" href="css/cnstyle.css">
        <link type="text/css" rel="stylesheet" href="css/tipsy.css">
        <link type="text/css" rel="stylesheet" href="css/tipsy-docs.css">
        <!-- include jQuery library -->
        <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.7/jquery.min.js"></script>
        <script src="js/lib/jquery.min.js"></script>
        <script src="js/hotspot-map.min.js"></script>
        <script src="js/jquery.tipsy.js"></script>
        <script type="text/javascript">
            $(function () {
                /**
                 * Lines 23-30 are only in place for demo purposes until we hook everything up
                 * They can be removed at some point along with the "show" section in html
                 * Anything that references #start and .show in cnstyle.css can also be removed at that time
                 */
                if (location.hash !== "") {
                    $("#start").removeClass("show");
                }

                $("#start").find("a").on("click", function () {
                    $("#start").removeClass("show");
                    $(this).off("click");
                });

                function set_body_height()
                {
                    var wh = $(window).height();
                    $(location.hash + " .hotspot_wrapper").attr('style', 'height:' + wh + 'px;');
                }

                /**
                 * Creates an instance of a Navigation Item 
                 * @constructor
                 * @this {Navigation}
                 * @param {string} tag The location tag of the navigation item (should be in form # + location, i.e #hurst
                 * @param {string} name The name of the navigation item corresponding to div id to be filled
                 * @param {string} styleClass The CSS style to apply
                 * @param {string} ttip Tool tip 
                 * @param {string} destination The hash location destination (i.e. "#hurst) 
                 * @param {string} direction The direction of navigation arrow (i.e. "back", "forward", "right", "left") 
                 * @param {string} fillColor Arrow fill color in form #CC0000
                 */
                function Navigation(tag, name, styleClass, ttip, dest, direction, fillColor) {
                    this.tag = tag;
                    this.name = name;
                    this.styleClass = styleClass;
                    this.ttip = ttip;
                    this.dest = dest;
                    this.direction = direction;
                    this.fillColor = fillColor;
                }
                ;

                /**
                 * Navigation object instances 
                 */
                var taylor_to_pathway = new Navigation("#taylor", "taylor_to_pathway", "forward_arrow", "to pathway", "#pathway", "forward", "#CC0000");
                var pathway_to_hurst = new Navigation("#pathway", "pathway_to_hurst", "forward_arrow", "to Hurst", "#hurst", "forward", "#CC0000");
                var pathway_to_taylor = new Navigation("#pathway", "pathway_to_taylor", "back_arrow", "back to Taylor", "#taylor", "back", "#CC0000");
                var pathway_to_quigly = new Navigation("#pathway", "pathway_to_quigly", "right_arrow", "to Quigly", "#quigly", "right", "#CC0000");
                var hurst_to_pathway = new Navigation("#hurst", "hurst_to_pathway", "back_arrow", "back to pathway", "#pathway", "back", "#CC0000");
                var hurst_to_kelley = new Navigation("#hurst", "hurst_to_kelley", "left_arrow", "to Kelley Hall", "#kelley", "left", "#CC0000"); 
                var quigly_to_pathway = new Navigation("#quigly", "quigly_to_pathway", "left_arrow", "back to pathway", "#pathway", "left", "#CC0000"); 
                var kelley_to_hurst = new Navigation("#kelley", "kelley_to_hurst", "right_arrow", "to Hurst Hall", "#hurst", "right", "#CC0000"); 
                var kelley_to_pathway2 = new Navigation("#kelley", "kelley_to_pathway2", "left_arrow", "to pathway", "#pathway2", "left", "#CC0000"); 
                var pathway2_to_library = new Navigation("#pathway2", "pathway2_to_library", "forward_arrow", "to Library", "#library", "forward", "#CC0000"); 
                var pathway2_to_kelley = new Navigation("#pathway2", "pathway2_to_kelley", "back_arrow", "to Kelley Hall", "#kelley", "back", "#CC0000"); 
                var library_to_pathway2 = new Navigation("#library", "library_to_pathway2", "back_arrow", "to pathway", "#pathway2", "back", "#CC0000"); 
                var library_to_universitycenter = new Navigation("#library", "library_to_universitycenter", "forward_arrow", "to University Center", "#universitycenter", "forward", "#CC0000"); 
                var universitycenter_to_library = new Navigation("#universitycenter", "universitycenter_to_library", "right_arrow", "to Library", "#library", "right", "#CC0000"); 
                var universitycenter_to_footballfield = new Navigation("#universitycenter", "universitycenter_to_footballfield", "left_arrow", "to Football Field", "#footballfield", "left", "#CC0000"); 
                var footballfield_to_universitycenter = new Navigation("#footballfield", "footballfield_to_universitycenter", "right_arrow", "to University Center", "#universitycenter", "right", "#CC0000"); 
                var navs = [taylor_to_pathway, pathway_to_hurst, pathway_to_taylor, pathway_to_quigly, hurst_to_pathway, 
                    hurst_to_kelley, quigly_to_pathway, kelley_to_hurst, kelley_to_pathway2, pathway2_to_library, 
                    pathway2_to_kelley, library_to_pathway2, library_to_universitycenter, universitycenter_to_library, 
                    universitycenter_to_footballfield, footballfield_to_universitycenter];

                /**
                 * Creates an instance of a Hotspot 
                 * @constructor
                 * @this {Hspot}
                 * @param {string} tag The location tag of the hotspot (should be in form # + location, i.e #hurst
                 * @param {string} name The name of the location corresponding to div id to be filled
                 * @param {Number} xLoc The x coordinate of the hotspot.
                 * @param {Number} yLoc The y coordinate of the hotspot. 
                 * @param {Number} width The width of the hotspot. 
                 * @param {Number} height The height of the hotspot.
                 * @param {Number} ttipWidth The width of the tooltip.
                 * @param {string} image The html code for image, i.e "<img src = . . ."  
                 * @param {string} position The position of the tooltip in relation to hspot, i.e. "top", "bottom", "left", "right"
                 * @param {string} type of hotspot, i.e. "spot", "rect"  
                 */
                function Hspot(tag, name, xLoc, yLoc, width, height, text, ttipWidth, image, position, type) {
                    this.tag = tag;
                    this.name = name;
                    this.xLoc = xLoc;
                    this.yLoc = yLoc;
                    this.width = width;
                    this.height = height;
                    this.text = text;
                    this.ttipWidth = ttipWidth;
                    this.image = image;
                    this.position = position;
                    this.type = type;
                }
                ;

                /**
                 * Hspot object instances 
                 */
                var taylor_hotspot = new Hspot("#taylor", "taylor_hotspot", 47, 50, 8, 8, 
                "Taylor Hall <br><br> <a href='panoramas/Taylor_Panorama/Taylor_Panorama.html' TARGET='_blank'>View Panorama</a>", 
                150, null, "right", "rect");
                var hurst_hotspot = new Hspot("#hurst", "hurst_hotspot", 50, 34, 30, 30, "This is Hurst, the building above all buildings. Check out the super cool things about it. So much Hurst.", 200, null, "bottom", "spot");
                var hotspots = [taylor_hotspot, hurst_hotspot];

                /**
                 * Render all hotspots at the current location
                 * @param {string} locationTag Location tag, should be in form "#" + location, i.e. "#Hurst" 
                 */
                function getHspots(locationTag) {
                    var inner_html = "";
                    for (var i in hotspots) {
                        if (hotspots[i].tag === locationTag) {
                            inner_html += "<div class='hs-spot-object' data-tint-color='#e52929' data-type=" + hotspots[i].type +
                                    " data-x =" + hotspots[i].xLoc + " data-y =" + hotspots[i].yLoc +
                                    " data-width = " + hotspots[i].width + " data-height = " + hotspots[i].height +
                                    " data-popup-position = " + hotspots[i].position + " data-visible = 'visible'" +
                                    "data-tooltip-width =" + hotspots[i].ttipWidth +
                                    " data-tooltip-auto-width= 'false'> " + hotspots[i].text + " </div>";
                            $(".icon-clear").css({'fill': "black", "color": "white"});
                            $(location.hash + " .hotspots").html(inner_html);
                        }
                    }
                    $(location.hash + " .hotspot_wrapper").hotspot({"show_on": "mouseover", "responsive": true});
                }

                /**
                 *  Render all navigation items at the current location
                 * @param {string} locationTag Location tag, should be in form "#" + location, i.e. "#hurst" 
                 */
                function getNavs(locationTag) {
                    $('.tipsy:last').remove();
                    var inner_html = "";
                    for (var i in navs) {
                        if (navs[i].tag === locationTag) {
                            var d = "M202.969,0l-99.438,130.824h52.213c8.629,89.9-25.768,176.225-120.373,206.957" +
                                    "c121.697,0.34,190.641-99.896,213.967-206.957h53.072L202.969,0z";
                            if (navs[i].direction === "forward") {
                                var flip = 0;
                                var viewBox = "'0 0 502 300'";
                            }
                            if (navs[i].direction === "back") {
                                flip = "transform='rotate(180 0 0)'";
                                viewBox = "'-300 -450 502 300'";
                            }
                            if (navs[i].direction === "right") {
                                flip = "transform='rotate(90,0,0)'";
                                viewBox = "'-450 -150 502 300'";
                            }
                            if (navs[i].direction === "left") {
                                flip = "transform='rotate(-90,0,0)'"; 
                                viewBox = "'-150 -200 502 300'";
                            }
                            inner_html += "<svg " + navs[i].dest + "' class=' " + navs[i].styleClass +
                                    " icon-clear icon-clear2' version='1.1' x='0px' y='0px' " +
                                    "width='500' height='200' viewBox= " + viewBox +
                                    " enable-background='new 200 0 200 502.174' xml:space='preserve'> " +
                                    "<use xlink:href = '#" + navs[i].name + "' class = 'icon-shadow' transform = 'translate(6, 5)' /> " +
                                    "<path onclick=javascript:window.location.hash='" + navs[i].dest +
                                    "' title='" + navs[i].ttip + "' class ='icon-clear2' id='" + navs[i].name + "' " +
                                    flip + " d=" + d + "/></svg>";
                            $(location.hash + " .navigation").html(inner_html);
                            $(".icon-clear").css({"fill": navs[i].fillColor});
                            $(".icon-clear2").tipsy({gravity: 'nw', fade: true});
                        }
                    }
                }

                /**
                 * Render main image for the current location
                 * @param {string} locationTag Location tag, should be in form "#" + location, i.e. "#hurst"
                 * locationTag should match image file, i.e "hurst_main.jpg" (substring removes "#") 
                 */
                function getImage(locationTag) {
                    $(location.hash + " .main_image").html("<img src='imgs/" + locationTag.substring(1) + "_main.jpg'/>");
                }

                /***Currently using location.hash, this will likely be replaced with getLocation()?
                 * Functions above requires the location tag passed in to be # + location tag name. (i.e "#hurst")
                 */
                $(window).on('hashchange', function () {
                    getImage(location.hash);
                    getHspots(location.hash);
                    getNavs(location.hash);
                    set_body_height();
                    $(window).bind('resize', function() { set_body_height(); });
                });
            });
        </script>
    </head>
    <body class="contextual_navigation">
        <!-- ISSUE: Content width doesn't appear to be responsive in Firefox-->
        <!-- Div class names are important for the JS --> 
        <div class="contextual_assets">
            <section class="show" id="start">
                <a href ="#taylor">
                    <button class="beginButton">Begin Tour</button>
                </a>
            </section> 
            <section id="taylor">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class ="hotspots">                   
                    </div> 
                </div>
                <div class="navigation">                   
                </div>
            </section>
            <section id="pathway">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation">
                </div>
            </section>
            <section id="hurst">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation"></div>
            </section>
            <section id="quigly">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation"></div>
            </section>
            <section id="kelley">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation"></div>
            </section>
            <section id="pathway2">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation"></div>
            </section>
            <section id="library">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation"></div>
            </section>
            <section id="universitycenter">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation"></div>
            </section>
            <section id="footballfield">
                <div class="hotspot_wrapper">
                    <div class="main_image">
                    </div> 
                    <div class="hotspots">                   
                    </div> 
                </div>
                <div class="navigation"></div>
            </section>
        </div>
    </body>
</html>